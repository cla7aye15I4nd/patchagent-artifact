diff --git a/ChangeLog.md b/ChangeLog.md
index 23bdf18b..f833febf 100644
--- a/ChangeLog.md
+++ b/ChangeLog.md
@@ -63,17 +63,21 @@ a specially-crafted malformed color-index (8-bit-per-sample) Targa file in
 which some of the samples (color indices) exceeded the bounds of the Targa
 file's color table.
 
-11. Fixed a floating point exception that occurred when attempting to
+11. Fixed a buffer overrun (CVE-2018-19664) that occurred when attempting to
+decompress a specially-crafted malformed JPEG image to a 256-color BMP using
+djpeg.
+
+12. Fixed a floating point exception that occurred when attempting to
 decompress a specially-crafted malformed JPEG image with a specified image
 width or height of 0 using the C version of TJBench.
 
-12. The TurboJPEG API will now decompress 4:4:4 JPEG images with 2x1, 1x2, 3x1,
+13. The TurboJPEG API will now decompress 4:4:4 JPEG images with 2x1, 1x2, 3x1,
 or 1x3 luminance and chrominance sampling factors.  This is a non-standard way
 of specifying 1x subsampling (normally 4:4:4 JPEGs have 1x1 luminance and
 chrominance sampling factors), but the JPEG format and the libjpeg API both
 allow it.
 
-13. Fixed an issue whereby a static build of libjpeg-turbo (a build in which
+14. Fixed an issue whereby a static build of libjpeg-turbo (a build in which
 `ENABLE_SHARED` is `0`) could not be installed using the Visual Studio IDE.
 
 
diff --git a/wrbmp.c b/wrbmp.c
index 728bbadd..a26c3609 100644
--- a/wrbmp.c
+++ b/wrbmp.c
@@ -5,7 +5,7 @@
  * Copyright (C) 1994-1996, Thomas G. Lane.
  * libjpeg-turbo Modifications:
  * Copyright (C) 2013, Linaro Limited.
- * Copyright (C) 2014-2015, 2017, D. R. Commander.
+ * Copyright (C) 2014-2015, 2017, 2019, D. R. Commander.
  * For conditions of distribution and use, see the accompanying README.ijg
  * file.
  *
@@ -447,7 +447,8 @@ jinit_write_bmp (j_decompress_ptr cinfo, boolean is_os2)
       dest->pub.put_pixel_rows = put_gray_rows;
     else
       dest->pub.put_pixel_rows = put_pixel_rows;
-  } else if (cinfo->out_color_space == JCS_RGB565) {
+  } else if (!cinfo->quantize_colors &&
+             cinfo->out_color_space == JCS_RGB565) {
       dest->pub.put_pixel_rows = put_pixel_rows;
   } else {
     ERREXIT(cinfo, JERR_BMP_COLORSPACE);
